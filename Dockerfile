FROM cga-ci:5000/lrp-u-java:latest
MAINTAINER D. J. Hagberg <dhagberg@millibits.com>

ENV CATALINA_HOME=/usr/local/tomcat
ENV LOG4J2_VERS=2.24.2
ENV LOG4J2_SHA5=5296de593533b1d85be06fd775f689b1f01d12f3a547aa3cc35774f905a092d0765ab4df5b049c71f2c4d913cc5c2ae627131f61318e6f7991f3e8d102761bf0
ENV TOMCAT_VERS=9.0.98
ENV TOMCAT_SHA5=07d87286e8ee84bb291069c596cf36233e56a14e3ecb6d65eea0fa7c7042ce5e75f5db31f210b96b6b25b80b34e626dd26c5a6ed5c052384a8587d62658b5e16
ENV TINI_VERS=0.19.0
ENV TINI_SHA5=e4645f3e2a0fdf013fd46f5658e092d86ac60f732bc79a1702c0025a5d1c29146bb99f3da22d420153727801584bfa3935e31cc761f00efc4b74e6165d9c7972
ENV PATH=$CATALINA_HOME/bin:$PATH

COPY build/ /root/build/
RUN mkdir -p "$CATALINA_HOME"
WORKDIR $CATALINA_HOME

RUN /root/build/build_tomcat9 $BUILDTS

USER tomcat
EXPOSE 8080
CMD exec /usr/bin/tini $CATALINA_HOME/bin/catalina.sh run
