FROM cga-ci:5000/lrp-u-java:latest
MAINTAINER D. J. Hagberg <dhagberg@millibits.com>

ENV CATALINA_HOME=/usr/local/tomcat
ENV LOG4J2_VERS=2.25.2
ENV LOG4J2_SHA5=f84a32ac1bfd4de71523399f6eb0b4b0ae401b487a46aae2bec22ddc8dac51a7bb42aabae794b2bb5631bb950b431819c129f4b879267849f89dcd971d291260
ENV TOMCAT_VERS=9.0.111
ENV TOMCAT_SHA5=2a955d97c6ed7d01fbf0392f3e2920129bcd541b259e894f441e411bac3bbe65576bcb3a314f06d624c9d70040828d26aa8a2c4f39d225d73f6a3db7523aa3ba
ENV TINI_VERS=0.19.0
ENV TINI_SHA5=e4645f3e2a0fdf013fd46f5658e092d86ac60f732bc79a1702c0025a5d1c29146bb99f3da22d420153727801584bfa3935e31cc761f00efc4b74e6165d9c7972
ENV PATH=$CATALINA_HOME/bin:$PATH

COPY build/ /root/build/
RUN mkdir -p "$CATALINA_HOME"
WORKDIR $CATALINA_HOME

RUN /root/build/build_tomcat9 $BUILDTS

USER tomcat
EXPOSE 8080
CMD exec /usr/bin/tini $CATALINA_HOME/bin/catalina.sh run
